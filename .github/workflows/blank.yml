name: Update LeetCode Solutions

on:
  workflow_dispatch:       # Manual trigger
  schedule:
    - cron: '0 0 * * *'   # Runs daily at midnight UTC

jobs:
  fetch-and-generate:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: "20"

      - name: Install leetcode-cli
        run: npm install -g leetcode-cli

      - name: Authenticate (optional)
        # Only needed if you want to access private submissions
        run: leetcode user -l "KrizzhSriskantharajah"

      - name: Fetch solved problems and generate MD
        run: |
          mkdir -p Easy Medium Hard
          # Fetch recent AC problems
          leetcode list -s ac -x --json > solved.json
          python - <<EOF
          import json, os, subprocess

          BASE_DIR = "."
          with open("solved.json") as f:
              problems = json.load(f)

          for problem in problems:
              title_slug = problem['titleSlug']
              difficulty = problem['difficulty'].capitalize()
              os.makedirs(os.path.join(BASE_DIR, difficulty), exist_ok=True)
              # Fetch solution code for Python
              result = subprocess.run(["leetcode", "show", title_slug, "-l", "python3"], capture_output=True, text=True)
              code = result.stdout
              md_path = os.path.join(BASE_DIR, difficulty, f"{title_slug}.md")
              with open(md_path, "w", encoding="utf-8") as f_md:
                  f_md.write(f"# {problem['title']}\n\n")
                  f_md.write(f"**Difficulty:** {difficulty}\n")
                  f_md.write(f"**Link:** [LeetCode](https://leetcode.com/problems/{title_slug}/)\n\n")
                  f_md.write("## Solution (Python)\n```python\n")
                  f_md.write(code)
                  f_md.write("\n```\n")
          EOF

      - name: Commit & Push Changes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add .
          git commit -m "Update LeetCode solutions" || echo "No changes to commit"
          git push
